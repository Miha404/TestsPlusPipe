defaultTasks 'clean', 'test'

apply plugin: 'java'
apply plugin: 'war'
apply plugin: 'scala'

sourceSets {
  main {
    java {srcDir 'src'}
    resources {srcDir 'src'}
  }
  test {
    java {srcDir 'test'}
    resources {srcDir 'test'}
    scala { srcDirs 'test' }
  }
}

repositories{
  mavenCentral()
}

task libs(type: Sync) {
  from configurations.compile
  from configurations.providedCompile
  from configurations.runtime
  from configurations.providedRuntime
  from configurations.testCompile
  into "$buildDir/lib"
}

classes.dependsOn libs

[compileJava, compileTestJava, compileScala, compileTestScala]*.options.collect {options -> options.encoding = 'UTF-8'}
[compileJava, compileTestJava, compileScala, compileTestScala]*.options.collect {options -> options.debug = true}

sourceCompatibility = 1.8
targetCompatibility = 1.8

test {
  include 'ee/era/hangman/**'
}

task uitest(type: Test) {
  systemProperties['browser'] = 'firefox'
}

task ie(type: Test) {
  systemProperties['browser'] = 'ie'
  systemProperties['timeout'] = '12000'
}

task chrome(type: Test) {
  systemProperties['browser'] = 'chrome'
}

tasks.withType(Test).all { testTask ->
  testTask.systemProperties['file.encoding'] = 'UTF-8'
  testTask.systemProperties['selenide.headless'] = 'true'
  testTask.testLogging.showStandardStreams = true
  testTask.outputs.upToDateWhen { false }
}

dependencies {
  providedCompile 'org.eclipse.jetty:jetty-server:9.3.9.M1'
  providedCompile 'org.eclipse.jetty:jetty-webapp:9.3.9.M1'
  providedCompile 'org.eclipse.jetty:jetty-jsp:9.3.0.M1'
  providedCompile 'org.eclipse.jetty.toolchain:jetty-osgi-servlet-api:3.1.0.M3'

  compile 'org.apache.struts:struts2-core:2.3.24.3'
  compile 'org.apache.struts.xwork:xwork-core:2.3.24.3'
  compile 'org.apache.struts:struts2-convention-plugin:2.3.24.3'
  compile 'org.apache.struts:struts2-json-plugin:2.3.24.3'
  compile 'org.liquibase:liquibase-core:3.6.2'
  compile('com.google.inject.extensions:guice-struts2:4.0') {
    exclude group: 'com.google.guava'
  }
  runtime 'com.h2database:h2:1.4.192'
  compile 'c3p0:c3p0:0.9.1.2'
  compile 'org.slf4j:slf4j-log4j12:1.7.30'
  testCompile 'org.hamcrest:hamcrest-all:1.3'
  testCompile('junit:junit:4.13') {transitive = false}
  testCompile 'org.mockito:mockito-core:3.3.3'
  testCompile 'com.codeborne:selenide:5.11.1'
  testCompile 'org.scala-lang:scala-library:2.11.8'
  testCompile 'org.scalatest:scalatest_2.11:3.0.0'
}

task(run, dependsOn: 'compile', type: JavaExec) {
  main = 'ee.era.hangman.Launcher'
  classpath = sourceSets.main.runtimeClasspath
  systemProperty 'file.encoding', 'UTF-8'
}

war {
  from 'webapp'
}
